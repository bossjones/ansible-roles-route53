---
- name: Testing the idempotence of removal
  hosts: localhost
  vars_files: [ './vars/removal.yml' ]
  pre_tasks:
    - route53_zone:
        zone: 'arch-admin.com'
        state: present
      register: zone_details

  roles:
    - route53

  tasks:
    - pause:
        minutes: 4

    - name: DNS records should be removed
      assert:
        that:
          - "'NXDOMAIN' == '{{ lookup('dig', 'chewy.arch-admin.com.', '@8.8.8.8') }}'"
          - "'NXDOMAIN' == '{{ lookup('dig', 'lottie.arch-admin.com.', '@8.8.8.8') }}'"
          - "'NXDOMAIN' == '{{ lookup('dig', 'lara.arch-admin.com.', '@8.8.8.8') }}'"
